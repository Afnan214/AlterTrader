import pg from "pg";
import dotenv from "dotenv";

dotenv.config();

const POSTGRESQL_USER = process.env.POSTGRESQL_USER;
const POSTGRESQL_HOST = process.env.POSTGRESQL_HOST;
const POSTGRESQL_DB = process.env.POSTGRESQL_DB;
const POSTGRESQL_PASSWORD = process.env.POSTGRESQL_PASSWORD;
const POSTGRESQL_PORT = process.env.POSTGRESQL_PORT;

const { Pool } = pg;

export const pool = new Pool({
  user: POSTGRESQL_USER,
  host: POSTGRESQL_HOST,
  database: POSTGRESQL_DB,
  password: POSTGRESQL_PASSWORD,
  port: POSTGRESQL_PORT,
  max: 20,
  idleTimeoutMillis: 30000,
});

export async function getUUIDByID(id) {
  const tableName = "numid";
  try {
    const res = await pool.query(`SELECT uid FROM ${tableName} WHERE id = $1`, [
      id,
    ]);
    console.log("----");
    console.log(res);
    console.log("----------");
    console.log(res.rows);
    console.log(res.rows.length === 0);
    console.log("----");

    return res;
  } catch (error) {
    console.error("Error executing query", error.stack);
  }
}

const alertsTableName = "alerts";

export async function getAlertsFromUser(user) {
  try {
    const res = await pool.query(
      `SELECT * FROM ${alertsTableName} WHERE user_id = $1`,
      [user]
    );
    console.log(res.rows);
    return res;
  } catch (error) {
    console.error("Error executing query", error.stack);
    throw error;
  }
}

export async function addAlert(alert) {
  try {
    const res = await pool.query(
      `INSERT INTO ${alertsTableName} (alert, user_id) VALUES ($1, $2)`,
      [alert, 1]
    );
    console.log(res);
    return res;
  } catch (error) {
    console.error("Error executing query", error.stack);
    throw error;
  }
}


// getData();
// addAlert("test123");
